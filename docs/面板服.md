# NAT1 Traversal

## 在面板中启用SO_REUSEPORT
您可以在以下方案中二选一进行设置。推荐使用[修改JAVA指令](#修改java指令)的操作方案，这样您无需为每个服务器重新创建启动脚本，只需要简单修改启动指令即可，并且可以避免直接shell注入（不能避免通过java进行间接shell注入，推荐面板服启用docker容器）。

### 创建启动脚本
您可以将启动指令移动到一个`shell`脚本，并将`LD_PRELOAD=./hook_bind.so`放置到指令的最前方。

假设您原本在面板中的启动指令为：
```shell
java -Xmx2G -jar fabric-server-mc.1.21.8-loader.0.16.14-launcher.1.0.3.jar nogui
```

您需要将其修改为如下样式并填入到一个`shell`脚本，例如`run.sh`中，并为该脚本添加可执行权限`chmod +x run.sh`。
```shell
#!/bin/bash
LD_PRELOAD=./hook_bind.so java -Xmx2G -jar fabric-server-mc.1.21.8-loader.0.16.14-launcher.1.0.3.jar nogui
```

为了不在每个游戏文件夹内都放置`hook_bind.so`您也可以将其放置到一个固定位置，并将`LD_PRELOAD`值设置为绝对路径，例如：

```shell
#!/bin/bash
LD_PRELOAD=/usr/local/auto_minecraft_server/hook_bind.so java -Xmx2G -jar fabric-server-mc.1.21.8-loader.0.16.14-launcher.1.0.3.jar nogui
```

然后将您的面板启动指令修改为`sh run.sh`。

此时您可以正常使用面板启动服务器。

### 修改JAVA指令
您可以创建`/usr/local/bin/java-bind`文件填入如下内容，并为该文件添加可执行权限（`chmod +x /usr/local/bin/java21-bind`）。
```shell
#!/bin/bash
export LD_PRELOAD=/usr/local/auto_minecraft_server/hook_bind.so
exec java $@
```

然后在面板的启动指令中将`java`替换为`java-bind`即可。
